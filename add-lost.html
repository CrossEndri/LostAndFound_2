<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Lost Item - Lost & Found</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <header>
        <div class="container">
            <nav>
                <a href="index.html" class="logo">Lost & Found</a>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="lost.html">Lost Items</a></li>
                    <li><a href="found.html">Found Items</a></li>
                </ul>
                <div id="auth-nav" style="display: flex; align-items: center;">
                    <!-- Auth buttons will be injected here -->
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card" style="max-width: 600px; margin: 0 auto;">
            <h2 class="mb-4">Report Lost Item</h2>
            <form id="add-item-form">
                <input type="hidden" id="type" value="lost">

                <div class="form-group">
                    <label for="title">Item Name</label>
                    <input type="text" id="title" required placeholder="e.g., iPhone 13 Pro, Blue Wallet">
                </div>

                <div class="form-group">
                    <label for="location">Last Seen Location</label>
                    <input type="text" id="location" required placeholder="e.g., Central Library, Bus Stop">
                </div>

                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" rows="4" required
                        placeholder="Provide details like color, size, distinguishing marks..."></textarea>
                </div>

                <div class="form-group">
                    <label for="contact">Contact Information</label>
                    <input type="text" id="contact" required placeholder="Phone number or email">
                </div>

                <div class="form-group">
                    <label for="reward">Reward (Optional)</label>
                    <input type="text" id="reward" placeholder="e.g., $50">
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Submit Report</button>
                    <a href="index.html" class="btn btn-outline" style="flex: 1; text-align: center;">Cancel</a>
                </div>
            </form>
        </div>
    </main>

    <script type="module">
        import { addItem } from './js/db.js';
        import { auth } from './js/firebase-config.js';

        const form = document.getElementById('add-item-form');

        // Check auth
        auth.onAuthStateChanged(user => {
            if (!user) {
                window.location.href = 'login.html';
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            const itemData = {
                type: document.getElementById('type').value,
                title: document.getElementById('title').value,
                location: document.getElementById('location').value,
                description: document.getElementById('description').value,
                contact: document.getElementById('contact').value,
                reward: document.getElementById('reward').value,
                userId: auth.currentUser.uid,
                userEmail: auth.currentUser.email
            };

            try {
                await addItem(itemData);
                window.location.href = 'lost.html';
            } catch (error) {
                console.error(error);
                alert('Error submitting report: ' + error.message);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Report';
            }
        });
    </script>
    <script type="module" src="js/app.js"></script>
</body>

</html>